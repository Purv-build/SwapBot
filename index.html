<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SwapBot</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
:root{
  --primary:#1E3A8A;
  --secondary:#3B82F6;
  --accent:#6366F1;
  --bg:#F4F6F8;
  --card:#FFFFFF;
  --text:#111827;
  --muted:#6B7280;
  --success:#22C55E;
  --warning:#F59E0B;
  --danger:#EF4444;
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:var(--bg);color:var(--text)}
header{
  background:var(--primary);
  color:white;
  text-align:center;
  padding:18px;
}
header img{width:70px;display:block;margin:0 auto 6px}
header small{color:#c7d2fe;font-size:13px;letter-spacing:.4px}

.card{
  background:var(--card);
  margin:16px;
  padding:18px;
  border-radius:14px;
  box-shadow:0 6px 14px rgba(0,0,0,.12);
}
.hidden{display:none}
h3{margin-top:0;color:var(--primary);text-align:center}

input,select,textarea,button{
  width:100%;
  padding:11px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  background:var(--secondary);
  color:white;
  border:none;
  cursor:pointer;
  transition:.2s;
}
button:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(0,0,0,.15)}
button.secondary{background:#e5e7eb;color:var(--primary)}
.section{margin-top:14px}
.section h4{margin-bottom:6px;color:var(--primary)}
.qr-box{
  border:2px dashed var(--accent);
  padding:14px;
  border-radius:14px;
  display:inline-block;
  background:#eef2ff;
  margin-top:10px;
}
.status{font-size:12px;padding:4px 8px;border-radius:8px}
.pending{background:#FEF3C7;color:#92400E}
.success{background:#DCFCE7;color:#166534}
.center{text-align:center}
</style>
</head>

<body>

<header>
  <img src="swapbot-logo.png">
  <h2>SwapBot</h2>
  <small>Smart Library Management System</small>
</header>

<!-- LOGIN -->
<div id="login" class="card">
<h3>Login</h3>
<select id="role">
  <option value="admin">Admin</option>
  <option value="librarian">Librarian</option>
  <option value="student">Student</option>
</select>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<button class="secondary" onclick="show('register')">Student Register</button>
</div>

<!-- REGISTER -->
<div id="register" class="card hidden">
<h3>Student Registration</h3>
<input id="rName" placeholder="Name">
<input id="rClass" placeholder="Class">
<input id="rRoll" placeholder="Roll No">
<input id="rEmail" placeholder="Email">
<input id="rPass" type="password" placeholder="Password">
<button onclick="registerStudent()">Register</button>
<button class="secondary" onclick="show('login')">Back</button>
</div>

<!-- STUDENT -->
<div id="student" class="card hidden">
<h3>Student Dashboard</h3>

<div class="section">
<h4>ğŸ“ My QR ID</h4>
<button onclick="generateStudentQR()">Generate QR</button>
<div id="studentQR" class="qr-box"></div>
</div>

<div class="section">
<h4>ğŸ Donate Book</h4>
<input id="donBook" placeholder="Book Name">
<button onclick="donateBook()">Donate</button>
</div>

<button class="secondary" onclick="logout()">Logout</button>
</div>

<!-- LIBRARIAN -->
<div id="librarian" class="card hidden">
<h3>Librarian Dashboard</h3>

<div class="section">
<h4>ğŸ“¦ Add Book (QR)</h4>
<input id="bookName" placeholder="Book Name">
<input id="bookNo" placeholder="Book Number">
<button onclick="generateBookQR()">Generate Book QR</button>
<div id="bookQR" class="qr-box"></div>
</div>

<div class="section">
<h4>ğŸ”„ Issue Book</h4>
<textarea id="studentQRText" placeholder="Paste Student QR text"></textarea>
<input id="issueBookNo" placeholder="Book Number">
<button onclick="issueBook()">Issue</button>
</div>

<div class="section">
<h4>ğŸ” Return Book</h4>
<input id="returnBookNo" placeholder="Book Number">
<button onclick="returnBook()">Return</button>
</div>

<div class="section">
<h4>ğŸ“‹ Issued Books</h4>
<div id="issuedList"></div>
</div>

<button class="secondary" onclick="logout()">Logout</button>
</div>

<!-- ADMIN -->
<div id="admin" class="card hidden">
<h3>Admin Dashboard</h3>

<div class="section">
<h4>ğŸ‘©â€ğŸ« Create Librarian</h4>
<input id="lEmail" placeholder="Email">
<input id="lPass" placeholder="Password">
<button onclick="createLibrarian()">Create</button>
</div>

<div class="section">
<h4>ğŸ” Change Admin Password</h4>
<input id="oldPass" type="password" placeholder="Current Password">
<input id="newPass" type="password" placeholder="New Password">
<button onclick="changeAdminPassword()">Update</button>
</div>

<button class="secondary" onclick="logout()">Logout</button>
</div>

<script>
let users=JSON.parse(localStorage.users||"[]");
let issued=JSON.parse(localStorage.issued||"[]");
let donations=JSON.parse(localStorage.donations||"[]");
let currentUser=null;

if(!users.find(u=>u.role==="admin")){
 users.push({role:"admin",email:"admin@swapbot.com",password:"admin123"});
 localStorage.users=JSON.stringify(users);
}

function show(id){
 document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
}
function logout(){
 sessionStorage.clear();
 currentUser=null;
 show("login");
}
function login(){
 let u=users.find(x=>x.role===role.value&&x.email===email.value&&x.password===password.value);
 if(!u){alert("Invalid credentials");return;}
 currentUser=u;
 sessionStorage.setItem("user",JSON.stringify(u));
 show(u.role);
}
window.onload=()=>{
 let u=sessionStorage.getItem("user");
 if(u){currentUser=JSON.parse(u);show(currentUser.role);}
}

function registerStudent(){
 users.push({role:"student",name:rName.value,class:rClass.value,roll:rRoll.value,email:rEmail.value,password:rPass.value});
 localStorage.users=JSON.stringify(users);
 alert("Registered successfully");
 show("login");
}

function generateStudentQR(){
 studentQR.innerHTML="";
 new QRCode(studentQR,{
  text:`SWAPBOT_STUDENT|name=${currentUser.name}|class=${currentUser.class}|roll=${currentUser.roll}|email=${currentUser.email}`,
  width:180,height:180
 });
}

function donateBook(){
 donations.push({student:currentUser.email,book:donBook.value});
 localStorage.donations=JSON.stringify(donations);
 alert("Donation submitted");
}

function generateBookQR(){
 bookQR.innerHTML="";
 new QRCode(bookQR,{
  text:`SWAPBOT_BOOK|name=${bookName.value}|no=${bookNo.value}`,
  width:160,height:160
 });
}

function issueBook(){
 if(!studentQRText.value.includes("email=")){alert("Invalid student QR");return;}
 let email=studentQRText.value.split("email=")[1];
 issued.push({book:issueBookNo.value,student:email});
 localStorage.issued=JSON.stringify(issued);
 alert("Book issued");
 renderIssued();
}

function returnBook(){
 issued=issued.filter(i=>i.book!==returnBookNo.value);
 localStorage.issued=JSON.stringify(issued);
 alert("Book returned");
 renderIssued();
}

function renderIssued(){
 issuedList.innerHTML=issued.length
  ? issued.map(i=>`<div>ğŸ“˜ ${i.book} â†’ ${i.student}</div>`).join("")
  : "<small>No books issued yet</small>";
}

function createLibrarian(){
 users.push({role:"librarian",email:lEmail.value,password:lPass.value});
 localStorage.users=JSON.stringify(users);
 alert("Librarian created");
}

function changeAdminPassword(){
 if(oldPass.value!==currentUser.password){alert("Wrong password");return;}
 currentUser.password=newPass.value;
 users=users.map(u=>u.role==="admin"?currentUser:u);
 localStorage.users=JSON.stringify(users);
 alert("Password updated");
}
</script>

<small style="display:block;text-align:center;color:#6B7280;margin:20px">
QR camera scanning may vary by device. Manual workflows ensure full reliability.
</small>

</body>
</html>
